!function(t){"use strict";function e(){}function r(t){var e;return function(){return e?void 0:(e=!0,t.apply(this,arguments))}}function n(t,e){return e?t.replace(/\{([^\}]+)\}/g,function(t,r){return e[r]}):function(e){return n(t,e)}}function a(){for(var t,e=y.call(arguments),r=y.call(arguments);r;){for(t in r)e[t]=r[t];r=y.call(arguments)}return e}function o(t){var e=t[0].toUpperCase()+t.substr(1);return e.replace(/([a-z])([A-Z])/,function(t,e,r){return e+"-"+r})}function s(t){var e=t[0].toLowerCase()+t.substr(1);return e.replace(/([a-z])-([A-Z])/,function(t,e,r){return e+r})}function c(t,e,r){var n=t&&t.match(E);return n&&("json"===n[3]?JSON.parse(data):"xml"===n[3]?r:e)}function i(t,e){e=e||{},e.headers=e.headers||{},e.url=t;var r=null,n={resolve:[],reject:[]};try{r=new XMLHttpRequest}catch(a){try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){r=new ActiveXObject("Microsoft.XMLHTTP")}}if(null===r)throw"Browser does not support HTTP Request";r.open((e.method||"get").toUpperCase(),t);for(var u in e.headers)r.setRequestHeader(o(u),e.headers[u]);r.resolve=function(t){n.resolve.forEach(function(e){e(t)})},r.reject=function(t){n.reject.forEach(function(e){e(t)})};var p;return r.getHeaders=function(){return p||(p=r.getAllResponseHeaders().replace(/\s*([^\:]+)\s*\:\s*([^\;\n]+)/g,function(t,e,n){r.headers[s(e)]=n.trim()})),p},r.onreadystatechange=function(){if("complete"===r.readyState||4===r.readyState){var t={data:c(r.getResponseHeader("content-type"),r.responseText,r.responseXML),status:r.status,headers:r.getHeaders,xhr:r};if(r.status>=200&&r.status<300)r.resolve(t);else{if(!(r.status>=400))throw new Error("Unexpected status code "+r.status);r.reject(t)}}},r.options=e,r.send(e.data),{then:function(t,e){n.resolve.push(t),e instanceof Function&&n.reject.push(onreject)},error:function(t){n.reject.push(t)}}}function u(t){if(t=t||{},t.version=t.version||g.version,t.sandbox=(void 0===t.sandbox?g.sandbox:t.sandbox)?".sandbox":"",t.paramsStr="",t.params)for(var e in t.params)t.paramsStr+=(t.paramsStr?"&":"?")+e+"="+encodeURIComponent(t.params[e]);return t}function p(t){if(!t)throw new Error("aplazame.init({options}) requires options");if(!t.publicKey)throw new Error("aplazame.init({options}) requires at least the publicKey");a(g,t)}function d(){return g}function f(t){return t=u(t),i(b.host+t.paramsStr,{headers:{accept:n(b.accept,t)}})}function h(t){return t=u(t),i(b.host+t.paramsStr,{method:"post",headers:{accept:n(b.accept,t)}})}function l(t){}function m(){}function v(t){t=a(new m,t||{}),i(t.host).then(function(e){console.log("iframeHtml",e);var n=e.data.replace(/(src|href)\s*=\s*\"(?!http|\/\/)/g,'src="'+t.host),o=document.createElement("iframe");o.src="data:text/html;charset=utf-8,"+encodeURI(n),a(o.style,w),o.frameBorder="0",document.body.appendChild(o),x(window,"message",r(function(e){"checkout:waiting"===e.data&&e.source.postMessage({checkout:t},"*")}))})}var w={position:"fixed",top:0,left:0,width:"100%",height:"100%"},b={host:"https://api.aplazame.com/",accept:"application/vnd.aplazame{sandbox}-v{version}+json"};e.prototype={version:1,sandbox:!1};var g=new e,x=window.addEventListener?function(t,e,r){t.addEventListener(e,r,!1)}:window.attachEvent&&function(t,e,r){t.attachEvent("on"+e,r)};if(!x)throw new Error("Your Browser does not support events");var y=[].shift,E=/([^\/]+)\/([^+]+\+)?(.*)/;if(window.http=i,m.prototype={host:"http://checkout.aplazame.com/"},document.querySelector("script[data-aplazame]")){var j=document.querySelector("script[data-aplazame]"),z=j.getAttribute("data-aplazame"),A={};/\s/.test(z)?z.split(",").forEach(function(t){var e=t.match(/^([^\:]+)\:(.*)/);A[e[1].trim()]=e[2].trim()}):(j.getAttribute("data-version")&&(A.version=Number(j.getAttribute("data-version"))),j.getAttribute("data-sandbox")&&(A.sandbox="true"===j.getAttribute("data-sandbox"))),p(A)}t.aplazame={init:p,getEnv:d,checkout:v,button:l,apiGet:f,apiPost:h}}(this);