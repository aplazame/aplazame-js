!function(e,t,n){"use strict";function r(e){e=e||{};var t=e.publicKey||m.publicKey;if(!t)throw new Error("public key needs to be specified");if(e=n.merge({},{headers:{authorization:"Bearer "+t}},e),e.version=e.version||p.version,e.sandbox=(void 0===e.sandbox?p.sandbox:e.sandbox)?".sandbox":"",e.paramsStr="",e.params)for(var r in e.params)e.paramsStr+=(e.paramsStr?"&":"?")+r+"="+encodeURIComponent(e.params[r]);return console.log("apiOptions",e),n.merge(e,{headers:{accept:n.replaceKeys(f,e)}})}function a(e,t){n.extend(p,t||{}),n.extend(m,e||{}),console.debug("init",m,p)}function o(e,a){a=r(a);var o=e?n.joinPath(p.host,e):p.host;return t(o+a.paramsStr,a)}function i(e,a,o){o=r(o);var i=e?n.joinPath(p.host,e):p.host;return t(i+o.paramsStr,n.merge(o,{method:"post",data:a}))}function s(e){if(!e)throw new Error("aplazame.button requires parameters");var t;if(e.button)t=[document.querySelector(e.button)];else{if(!e.id)throw new Error("button can not be identified ( please use - id: 'button-id' - or - button: '#button-id' - )");t=[document.querySelector((/^#/.test(e.id)?"":"#")+e.id)]}e.description&&[].push.apply(t,document.querySelectorAll(e.description)),t.forEach(function(e){e.__display=e.style.display,e.style.display="none"});var n={amount:e.amount,currency:e.currency||"EUR"};e.country&&(n.country=e.country),o("checkout/button",{params:n}).then(function(){t.forEach(function(e){e.style.display=e.__display})})}function c(e,t){var n=e.contentWindow.document;n.charset="UTF-8",n.open(),n.write(t),n.close()}function u(e){e=e||{};var r=("location"===e.host?location.origin:e.host)||"https://aplazame.com/static/checkout/";e.api=p,/\/$/.test(r)||(r+="/"),t(r+"iframe.html").then(function(t){document.body.style.overflow="hidden";var a=t.data.replace(/\<head\>/,'<head><base href="'+r+'" />'),o=document.createElement("iframe");if(n.extend(o.style,l),o.frameBorder="0",document.body.appendChild(o),c(o,a),!e.merchant)throw new Error("missing merchant parameters");if(!e.merchant.public_api_key){if(!m.publicKey)throw new Error("missing public key");e.merchant.public_api_key=m.publicKey}n.listen(window,"message",function(t){if(o){var n=t.data;if("checkout"===n.aplazame&&"merchant"===n.require)t.source.postMessage({checkout:e},"*");else if("checkout"===n.aplazame&&n.result)switch(document.body.removeChild(o),o=null,console.debug("message.aplazame",n.result),n.result){case"success":location.replace(e.merchant.success_url);break;case"cancel":location.replace(e.merchant.cancel_url)}}})},function(){console.error("checkout server",r,"should be running")})}function d(e,t,r){n.isFunction(t)?(r=t,t={}):t=t||{};var a={params:{amount:e}};t.payday&&(a.params.payday=t.payday),t.publicKey&&(a.publicKey=t.publicKey),aplazame.apiGet("instalment-plan-simulator",a).then(function(e){n.isFunction(r)&&r(e.data.choices[0].instalments)})}var l={position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"transparent","z-index":2147483647},p={host:"https://api.aplazame.com/",version:1,checkoutVersion:1,sandbox:!1},f="application/vnd.aplazame{{sandbox}}.v{{version}}+json",m={};e.aplazame={init:a,checkout:u,button:s,apiGet:o,apiPost:i,simulator:d}}(this,function(){function e(e){var t=e[0].toUpperCase()+e.substr(1);return t.replace(/([a-z])([A-Z])/,function(e,t,n){return t+"-"+n})}function t(e){var t=e[0].toLowerCase()+e.substr(1);return t.replace(/([a-z])-([A-Z])/,function(e,t,n){return t+n})}function n(e,t,n){var r=e&&e.match(a);return r&&("json"===r[3]?JSON.parse(t):"xml"===r[3]?n:t)}function r(r,a){console.debug("http",r,a),a=a||{},a.headers=a.headers||{},a.url=r;var o=null,i={resolve:[],reject:[]};try{o=new XMLHttpRequest}catch(s){try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){o=new ActiveXObject("Microsoft.XMLHTTP")}}if(null===o)throw"Browser does not support HTTP Request";o.open((a.method||"get").toUpperCase(),r),a.withCredentials&&(o.withCredentials=!0);for(var u in a.headers)o.setRequestHeader(e(u),a.headers[u]);o.resolve=function(e){i.resolve.forEach(function(t){t(e)})},o.reject=function(e){i.reject.forEach(function(t){t(e)})};var d;return o.getHeaders=function(){return d||(d={},o.getAllResponseHeaders().replace(/\s*([^\:]+)\s*\:\s*([^\;\n]+)/g,function(e,n,r){d[t(n)]=r.trim()})),d},o.onreadystatechange=function(){if("complete"===o.readyState||4===o.readyState){var e={data:n(o.getResponseHeader("content-type"),o.responseText,o.responseXML),status:o.status,headers:o.getHeaders,xhr:o};if(o.status>=200&&o.status<300)o.resolve(e);else{if(!(o.status>=400))throw new Error("Unexpected status code "+o.status);o.reject(e)}}},o.options=a,o.send(a.data),{then:function(e,t){i.resolve.push(e),t instanceof Function&&i.reject.push(t)},error:function(e){i.reject.push(e)}}}var a=/([^\/]+)\/([^+]+\+)?(.*)/;return window.http=r,r}(),function(){function e(e){return function(t){return typeof t===e}}function t(e){return function(t){return t instanceof e}}function n(e){var t;return function(){return t?void 0:(t=!0,e.apply(this,arguments))}}function r(e){"complete"===document.readyState?e():b(window,"load",e)}function a(e,t){return t?e.replace(/\{\{([^\}]+)\}\}/g,function(e,n){return t[n]}):function(t){return a(e,t)}}function o(){for(var e,t=y.call(arguments),n=y.call(arguments);n;){for(e in n)t[e]=n[e];n=y.call(arguments)}return t}function i(){for(var e,t=y.call(arguments),n=y.call(arguments);n;){if(typeof t!=typeof n&&(t=p(n)?[]:c(n)?{}:n),c(n))for(e in n)void 0!==n[e]&&(typeof t[e]!=typeof n[e]?t[e]=i(void 0,n[e]):p(t[e])?[].push.apply(t[e],n[e]):c(t[e])?t[e]=i(t[e],n[e]):t[e]=n[e]);n=y.call(arguments)}return t}function s(){return console.debug("joinPath",arguments),[].reduce.call(arguments,function(e,t,n,r){return t=n?t.replace(/^\//,""):t,t=n===r.length-1?t:t.replace(/\/$/,""),e+(n?"/":"")+t},"")}var c=e("object"),u=e("function"),d=e("string"),l=e("number"),p=Array.isArray||t(Array),f=t(Date),m=t(RegExp),h=function(e){return e&&1===e.nodeType},b=window.addEventListener?function(e,t,n){e.addEventListener(t,n,!1)}:window.attachEvent&&function(e,t,n){e.attachEvent("on"+t,n)};if(!b)throw new Error("Your Browser does not support events");var y=[].shift;return{isObject:c,isFunction:u,isString:d,isNumber:l,isArray:p,isDate:f,isRegExp:m,isElement:h,listen:b,once:n,ready:r,replaceKeys:a,merge:i,extend:o,joinPath:s}}()),function(){var e=document.querySelector('script[src*="aplazame.js"]');if(e){var t=e.src.split("?"),n=t&&t[1]&&t[1].match(/sandbox\=([^&]*)/);n&&aplazame.init({},{sandbox:"1"===n[1]||"true"===n[1]})}if(document.querySelector("script[data-aplazame]")){var r=document.querySelector("script[data-aplazame]"),a=r.getAttribute("data-aplazame"),o={},i={};if(/\:/.test(a)?a.split(",").forEach(function(e){var t=e.match(/^([^\:]+)\:(.*)/);o[t[1].trim()]=t[2].trim()}):a&&(o.publicKey=a),r.getAttribute("data-version")){var s=r.getAttribute("data-version").match(/^v?(\d)(\.(\d))?$/);if(!s)throw new Error("malformed version, should be like 'v1.2'");i.version=Number(s[1]),void 0!==s[3]&&(i.checkoutVersion=Number(s[3]))}r.getAttribute("data-sandbox")&&(i.sandbox="true"===r.getAttribute("data-sandbox")),r.getAttribute("data-analytics")&&(o.analytics="true"===r.getAttribute("data-analytics")),aplazame.init(o,i)}}(),function(){var e=document.querySelector("[data-aplazame-button]");if(e){var t={button:"[data-aplazame-button]",description:"[data-aplazame-button-info]",publicKey:e.getAttribute("data-aplazame-button"),amount:e.getAttribute("data-amount"),currency:e.getAttribute("data-currency")||void 0,sandbox:e.getAttribute("data-sandbox")?"true"===e.getAttribute("data-sandbox"):void 0,country:e.getAttribute("data-country")||void 0};aplazame.button(t),console.debug("button found",t)}}();