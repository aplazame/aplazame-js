!function(e){"use strict";function t(){}function r(e,t){return t?e.replace(/\{\{([^\}]+)\}\}/g,function(e,r){return t[r]}):function(t){return r(e,t)}}function a(){for(var e,t=x.call(arguments),r=x.call(arguments);r;){for(e in r)t[e]=r[e];r=x.call(arguments)}return t}function n(){return console.debug("joinPath",arguments),[].reduce.call(arguments,function(e,t,r,a){return t=r?t.replace(/^\//,""):t,t=r===a.length-1?t:t.replace(/\/$/,""),e+(r?"/":"")+t},"")}function o(e){var t=e[0].toUpperCase()+e.substr(1);return t.replace(/([a-z])([A-Z])/,function(e,t,r){return t+"-"+r})}function s(e){var t=e[0].toLowerCase()+e.substr(1);return t.replace(/([a-z])-([A-Z])/,function(e,t,r){return t+r})}function c(e,t,r){var a=e&&e.match(z);return a&&("json"===a[3]?JSON.parse(data):"xml"===a[3]?r:t)}function i(e,t){t=t||{},t.headers=t.headers||{},t.url=e;var r=null,a={resolve:[],reject:[]};try{r=new XMLHttpRequest}catch(n){try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){r=new ActiveXObject("Microsoft.XMLHTTP")}}if(null===r)throw"Browser does not support HTTP Request";r.open((t.method||"get").toUpperCase(),e);for(var u in t.headers)r.setRequestHeader(o(u),t.headers[u]);r.resolve=function(e){a.resolve.forEach(function(t){t(e)})},r.reject=function(e){a.reject.forEach(function(t){t(e)})};var p;return r.getHeaders=function(){return p||(p=r.getAllResponseHeaders().replace(/\s*([^\:]+)\s*\:\s*([^\;\n]+)/g,function(e,t,a){r.headers[s(t)]=a.trim()})),p},r.onreadystatechange=function(){if("complete"===r.readyState||4===r.readyState){var e={data:c(r.getResponseHeader("content-type"),r.responseText,r.responseXML),status:r.status,headers:r.getHeaders,xhr:r};if(r.status>=200&&r.status<300)r.resolve(e);else{if(!(r.status>=400))throw new Error("Unexpected status code "+r.status);r.reject(e)}}},r.options=t,r.send(t.data),{then:function(e,t){a.resolve.push(e),t instanceof Function&&a.reject.push(t)},error:function(e){a.reject.push(e)}}}function u(e){if(e=e||{},e.version=e.version||g.version,e.sandbox=(void 0===e.sandbox?g.sandbox:e.sandbox)?".sandbox":"",e.paramsStr="",e.params)for(var t in e.params)e.paramsStr+=(e.paramsStr?"&":"?")+t+"="+encodeURIComponent(e.params[t]);return e}function p(e){if(!e)throw new Error("aplazame.init({options}) requires options");if(!e.publicKey)throw new Error("aplazame.init({options}) requires at least the publicKey");a(g,e)}function l(){return g}function d(e,t){t=u(t);var a=e?n(y.host,e):y.host;return i(a+t.paramsStr,{headers:{accept:r(y.accept,t)}})}function m(e,t,a){a=u(a);var o=e?n(y.host,e):y.host;return i(o+a.paramsStr,{method:"post",headers:{accept:r(y.accept,a)}})}function f(e){if(!e)throw new Error("aplazame.button requires parameters");var t=[document.querySelector(e.button)];e.description&&t.concat([].slice.call(document.querySelectorAll(e.description))),t.forEach(function(e){e.__display=e.style.display,e.style.display="none"});var r={amount:e.amount,currency:e.currency||"EUR"};i.apiPost("checkout/button",r)}function h(e,t){var r=e.contentWindow.document;r.open(),r.write(t),r.close()}function v(e){e=e||{};var t="location"===e.host?location.origin:e.host;/\/$/.test(t)||(t+="/"),i(t+"iframe.html").then(function(r){document.body.style.overflow="hidden";var n=r.data.replace(/(src|href)\s*=\s*\"(?!http|\/\/)/g,'$1="'+t),o=document.createElement("iframe");if(a(o.style,b),o.frameBorder="0",document.body.appendChild(o),h(o,n),!e.merchant)throw new Error("missing merchant parameters");if(!e.merchant.public_api_key){if(!g.publicKey)throw new Error("missing public key");e.merchant.public_api_key=g.publicKey}w(window,"message",function(t){if(o){var r=t.data;if("checkout"===r.aplazame&&"merchant"===r.require)t.source.postMessage({checkout:e},"*");else if("checkout"===r.aplazame&&r.result)switch(document.body.removeChild(o),o=null,console.debug("message.aplazame",r.result),r.result){case"success":location.replace(e.merchant.success_url);break;case"cancel":location.replace(e.merchant.cancel_url)}}})},function(){console.error("checkout server",t,"should be running")})}var b={position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"transparent"},y={host:"https://api.aplazame.com/",accept:"application/vnd.aplazame{{sandbox}}-v{{version}}+json"};t.prototype={version:1,sandbox:!1};var g=new t,w=window.addEventListener?function(e,t,r){e.addEventListener(t,r,!1)}:window.attachEvent&&function(e,t,r){e.attachEvent("on"+t,r)};if(!w)throw new Error("Your Browser does not support events");var x=[].shift,z=/([^\/]+)\/([^+]+\+)?(.*)/;if(window.http=i,document.querySelector("script[data-aplazame]")){var E=document.querySelector("script[data-aplazame]"),A=E.getAttribute("data-aplazame"),S={};/\:/.test(A)?A.split(",").forEach(function(e){var t=e.match(/^([^\:]+)\:(.*)/);S[t[1].trim()]=t[2].trim()}):(A&&(S.publicKey=A),E.getAttribute("data-version")&&(S.version=Number(E.getAttribute("data-version"))),E.getAttribute("data-sandbox")&&(S.sandbox="true"===E.getAttribute("data-sandbox"))),p(S)}e.aplazame={init:p,getEnv:l,checkout:v,button:f,apiGet:d,apiPost:m}}(this),function(){var e=document.querySelector("[data-aplazame-payment]");if(e){({button:"[data-aplazame-payment]",description:"[data-aplazame-payment-info]",publicKey:e.getAttribute("data-aplazame-payment"),amount:e.getAttribute("data-amount"),currency:e.getAttribute("data-currency"),sandbox:"true"===(e.getAttribute("data-sandbox")||"false")})}}();