!function(t,e,r){"use strict";function n(t){t=t||{};var e=t.publicKey||f.publicKey;if(!e)throw new Error("public key needs to be specified");if(t=r.merge({},{headers:{authorization:"Bearer "+e}},t),t.version=t.version||d.version,t.sandbox=(void 0===t.sandbox?d.sandbox:t.sandbox)?".sandbox":"",t.paramsStr="",t.params)for(var n in t.params)t.paramsStr+=(t.paramsStr?"&":"?")+n+"="+encodeURIComponent(t.params[n]);return console.log("apiOptions",t),r.merge(t,{headers:{accept:r.replaceKeys(m,t)}})}function a(t,e){r.extend(d,e||{}),r.extend(f,t||{}),console.debug("init",f,d)}function o(t,a){a=n(a);var o=t?r.joinPath(d.host,t):d.host;return e(o+a.paramsStr,a)}function i(t,a,o){o=n(o);var i=t?r.joinPath(d.host,t):d.host;return e(i+o.paramsStr,r.merge(o,{method:"post",data:a}))}function c(t){if(!t)throw new Error("aplazame.button requires parameters");var e,r;if(t.button?r=document.querySelector(t.button):t.id&&(r=document.querySelector((/^#/.test(t.id)?"":"#")+t.id)),!r)throw new Error("button can not be identified ( please use - id: 'button-id' - or - button: '#button-id' - )");if(e=[r],t.parent)for(var n=r.parentElement;n&&n!==document.body;){if(n.matchesSelector(t.parent)){e.push(n);break}n=n.parentElement}t.description&&[].push.apply(e,document.querySelectorAll(t.description)),e.forEach(function(t){t.__display=t.style.display,t.style.display="none"});var a={amount:t.amount,currency:t.currency||"EUR"};t.country&&(a.country=t.country),o("checkout/button",{params:a}).then(function(){e.forEach(function(t){t.style.display=t.__display})})}function s(t,e){var r=t.contentWindow.document;r.charset="UTF-8",r.open(),r.write(e),r.close()}function u(t){t=t||{};var n=("location"===t.host?location.origin:t.host)||"https://aplazame.com/static/checkout/";t.api=d,/\/$/.test(n)||(n+="/"),e(n+"iframe.html").then(function(e){document.body.style.overflow="hidden";var a=e.data.replace(/\<head\>/,'<head><base href="'+n+'" />'),o=document.createElement("iframe");if(r.extend(o.style,l),o.frameBorder="0",document.body.appendChild(o),s(o,a),!t.merchant)throw new Error("missing merchant parameters");if(!t.merchant.public_api_key){if(!f.publicKey)throw new Error("missing public key");t.merchant.public_api_key=f.publicKey}r.listen(window,"message",function(e){if(o){var r=e.data;if("checkout"===r.aplazame&&"merchant"===r.require)e.source.postMessage({checkout:t},"*");else if("checkout"===r.aplazame&&r.result)switch(document.body.removeChild(o),o=null,r.result){case"success":location.replace(t.merchant.success_url);break;case"cancel":location.replace(t.merchant.cancel_url)}}})},function(){throw new Error("can not connect to "+n)})}function p(t,e,n){r.isFunction(e)?(n=e,e={}):e=e||{};var a={params:{amount:t}};e.payday&&(a.params.payday=e.payday),e.publicKey&&(a.publicKey=e.publicKey),aplazame.apiGet("instalment-plan-simulator",a).then(function(t){r.isFunction(n)&&n(t.data.choices[0].instalments)})}var l={position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"transparent","z-index":2147483647},d={host:"https://api.aplazame.com/",version:1,checkoutVersion:1,sandbox:!1},m="application/vnd.aplazame{{sandbox}}.v{{version}}+json",f={};t.aplazame={init:a,checkout:u,button:c,apiGet:o,apiPost:i,simulator:p}}(this,function(){function t(t){var e=t[0].toUpperCase()+t.substr(1);return e.replace(/([a-z])([A-Z])/,function(t,e,r){return e+"-"+r})}function e(t){var e=t[0].toLowerCase()+t.substr(1);return e.replace(/([a-z])-([A-Z])/,function(t,e,r){return e+r})}function r(t,e,r){var n=t&&t.match(a);return n&&("json"===n[3]?JSON.parse(e):"xml"===n[3]?r:e)}function n(n,a){a=a||{},a.headers=a.headers||{},a.url=n;var o=null,i={resolve:[],reject:[]};try{o=new XMLHttpRequest}catch(c){try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(s){o=new ActiveXObject("Microsoft.XMLHTTP")}}if(null===o)throw"Browser does not support HTTP Request";o.open((a.method||"get").toUpperCase(),n),a.withCredentials&&(o.withCredentials=!0);for(var u in a.headers)o.setRequestHeader(t(u),a.headers[u]);o.resolve=function(t){i.resolve.forEach(function(e){e(t)})},o.reject=function(t){i.reject.forEach(function(e){e(t)})};var p;return o.getHeaders=function(){return p||(p={},o.getAllResponseHeaders().replace(/\s*([^\:]+)\s*\:\s*([^\;\n]+)/g,function(t,r,n){p[e(r)]=n.trim()})),p},o.onreadystatechange=function(){if("complete"===o.readyState||4===o.readyState){var t={data:r(o.getResponseHeader("content-type"),o.responseText,o.responseXML),status:o.status,headers:o.getHeaders,xhr:o};if(o.status>=200&&o.status<300)o.resolve(t);else{if(!(o.status>=400))throw new Error("Unexpected status code "+o.status);o.reject(t)}}},o.options=a,o.send(a.data),{then:function(t,e){i.resolve.push(t),e instanceof Function&&i.reject.push(e)},error:function(t){i.reject.push(t)}}}var a=/([^\/]+)\/([^+]+\+)?(.*)/;return window.http=n,n}(),function(){function t(t){return function(e){return typeof e===t}}function e(t){return function(e){return e instanceof t}}function r(t){var e;return function(){return e?void 0:(e=!0,t.apply(this,arguments))}}function n(t){"complete"===document.readyState?t():y(window,"load",t)}function a(t,e){return e?t.replace(/\{\{([^\}]+)\}\}/g,function(t,r){return e[r]}):function(e){return a(t,e)}}function o(){for(var t,e=b.call(arguments),r=b.call(arguments);r;){for(t in r)e[t]=r[t];r=b.call(arguments)}return e}function i(){for(var t,e=b.call(arguments),r=b.call(arguments);r;){if(typeof e!=typeof r&&(e=d(r)?[]:s(r)?{}:r),s(r))for(t in r)void 0!==r[t]&&(typeof e[t]!=typeof r[t]?e[t]=i(void 0,r[t]):d(e[t])?[].push.apply(e[t],r[t]):s(e[t])?e[t]=i(e[t],r[t]):e[t]=r[t]);r=b.call(arguments)}return e}function c(){return[].reduce.call(arguments,function(t,e,r,n){return e=r?e.replace(/^\//,""):e,e=r===n.length-1?e:e.replace(/\/$/,""),t+(r?"/":"")+e},"")}Element.prototype.matchesSelector||(Element.prototype.matchesSelector=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector);var s=t("object"),u=t("function"),p=t("string"),l=t("number"),d=Array.isArray||e(Array),m=e(Date),f=e(RegExp),h=function(t){return t&&1===t.nodeType},y=window.addEventListener?function(t,e,r){t.addEventListener(e,r,!1)}:window.attachEvent&&function(t,e,r){t.attachEvent("on"+e,r)};if(!y)throw new Error("Your Browser does not support events");var b=[].shift;return{isObject:s,isFunction:u,isString:p,isNumber:l,isArray:d,isDate:m,isRegExp:f,isElement:h,listen:y,once:r,ready:n,replaceKeys:a,merge:i,extend:o,joinPath:c}}()),function(){var t=document.querySelector('script[src*="aplazame.js"]');if(t){var e=t.src.split("?"),r=e&&e[1]&&e[1].match(/sandbox\=([^&]*)/);r&&aplazame.init({},{sandbox:"1"===r[1]||"true"===r[1]})}if(document.querySelector("script[data-aplazame]")){var n=document.querySelector("script[data-aplazame]"),a=n.getAttribute("data-aplazame"),o={},i={};if(/\:/.test(a)?a.split(",").forEach(function(t){var e=t.match(/^([^\:]+)\:(.*)/);o[e[1].trim()]=e[2].trim()}):a&&(o.publicKey=a),n.getAttribute("data-version")){var c=n.getAttribute("data-version").match(/^v?(\d)(\.(\d))?$/);if(!c)throw new Error("malformed version, should be like 'v1.2'");i.version=Number(c[1]),void 0!==c[3]&&(i.checkoutVersion=Number(c[3]))}n.getAttribute("data-sandbox")&&(i.sandbox="true"===n.getAttribute("data-sandbox")),n.getAttribute("data-analytics")&&(o.analytics="true"===n.getAttribute("data-analytics")),aplazame.init(o,i)}}(),function(){var t=document.querySelector("[data-aplazame-button]");if(t){var e={button:"[data-aplazame-button]",description:"[data-aplazame-button-info]",parent:t.getAttribute("data-parent"),publicKey:t.getAttribute("data-aplazame-button"),amount:t.getAttribute("data-amount"),currency:t.getAttribute("data-currency")||void 0,sandbox:t.getAttribute("data-sandbox")?"true"===t.getAttribute("data-sandbox"):void 0,country:t.getAttribute("data-country")||void 0};aplazame.button(e)}}();